<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="Release dashboard">
<meta name="author" content="Pawel Duda">
<meta http-equiv="refresh" content="3600">

<title>Release dashboad</title>

<!-- Bootstrap core CSS -->
<link href="./css/bootstrap.min.css" rel="stylesheet">

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<link href="./css/ie10-viewport-bug-workaround.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="./css/cover.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
<script src="./js/ie-emulation-modes-warning.js"></script>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<div class="site-wrapper">

  <div class="site-wrapper-inner">

    <div class="cover-container">

      <div class="inner cover">
        <h1 class="release cover-heading">Release 45</h1>
        <h2 class="release-period cover-heading">10/10/2016 - 24/10/2016</h2>
        <div class="release-bar progress">
          <span class="progress-bar-text-inside">1 day left</span>
          <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
          </div>
        </div>
      </div>

    </div>

  </div>

</div>

<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="./js/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="./js/jquery.min.js"><\/script>')</script>
<script src="./js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="./js/ie10-viewport-bug-workaround.js"></script>
<script src="./js/moment.js"></script>
<script src="./js/extract-params-from-uri.js"></script>
<script src="./js/pawel-test-framework.js"></script>
<script>

$(document).ready(function() {
    function howMuchTimeLeft(startDate, endDate, nowDate) {
      var diffDays = endDate.diff(nowDate, 'days');
      if (diffDays === 0) { return "taking a cut today";}
      if (diffDays === 1) { return "taking a cut tomorrow";}
      return "taking a cut in " + diffDays + " days";
    };

    function progressBarStyle(startDate, endDate, nowDate) {
      var diffDays = endDate.diff(nowDate, 'days');
      if (diffDays <= 2) { return "progress-bar-danger";}
      if (diffDays <= 7) { return "progress-bar-warning";}
      return "progress-bar-success";
    };

    function datesForTheContent(startDate, endDate) {
      var dateTimeFormat = "MMMM Do";
      return startDate.format(dateTimeFormat) + " - " + endDate.format(dateTimeFormat);
    };

    function progressBarPercentage(startDate, endDate, nowDate) {
      var totalMinutes = endDate.diff(startDate, 'minutes');
      var passedMinutes = nowDate.diff(startDate, 'minutes');
      var percentage = 100 * passedMinutes/totalMinutes;
      return percentage.toFixed(2).toString();
    };

    var refStartDate = moment($_GET("refStartDate"));
    var refEndDate = moment($_GET("refEndDate"));
    var nowDate = moment();
    $(".release-period").text(datesForTheContent(refStartDate, refEndDate));
    $(".progress-bar-text-inside").text(howMuchTimeLeft(refStartDate, refEndDate, nowDate));
    $(".progress-bar").attr("aria-valuenow", progressBarPercentage(refStartDate, refEndDate, nowDate));
    $(".progress-bar").css("width",  "" + progressBarPercentage(refStartDate, refEndDate, nowDate) + "%");
    $(".progress-bar").addClass(progressBarStyle(refStartDate, refEndDate, nowDate));

    var release = $_GET("releaseWord") + " " + $_GET("refName");
    $(".release").text(release);




    // TEST SUITE
    var testSuiteTimeLeft = new TestSuite();
    testSuiteTimeLeft.addTest("Time left on the day of the cut - Wednesday", function() {
        var actual = howMuchTimeLeft(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-10T10:00:00.000Z"));
        Assert.assertEquals("taking a cut today", actual);
    });
    testSuiteTimeLeft.addTest("Time left on the day before cut - Tuesday", function() {
        var actual = howMuchTimeLeft(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-09T10:00:00.000Z"));
        Assert.assertEquals("taking a cut tomorrow", actual);
    });
    testSuiteTimeLeft.addTest("Time left two days before cut - Monday", function() {
        var actual = howMuchTimeLeft(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-08T10:00:00.000Z"));
        Assert.assertEquals("taking a cut in 2 days", actual);
    });

    testSuiteTimeLeft.addTest("Progress bar on the day of the cut - Wednesday", function() {
        var actual = progressBarStyle(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-10T10:00:00.000Z"));
        Assert.assertEquals("progress-bar-danger", actual);
    });
    testSuiteTimeLeft.addTest("Progress bar during the week of the cut - Monday", function() {
        var actual = progressBarStyle(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-08T10:00:00.000Z"));
        Assert.assertEquals("progress-bar-danger", actual);
    });
    testSuiteTimeLeft.addTest("Progress bar during the middle week - Sunday", function() {
        var actual = progressBarStyle(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-07T10:00:00.000Z"));
        Assert.assertEquals("progress-bar-warning", actual);
    });
    testSuiteTimeLeft.addTest("Progress bar a week before the cut - Wednesday", function() {
        var actual = progressBarStyle(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-03T10:00:00.000Z"));
        Assert.assertEquals("progress-bar-warning", actual);
    });
    testSuiteTimeLeft.addTest("Progress bar more than a week before the cut - Tuesday", function() {
        var actual = progressBarStyle(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-02T10:00:00.000Z"));
        Assert.assertEquals("progress-bar-success", actual);
    });

    testSuiteTimeLeft.addTest("Dates for the content", function() {
        var actual = datesForTheContent(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"));
        Assert.assertEquals("July 27th - August 10th", actual);
    });

    testSuiteTimeLeft.addTest("Progress bar percentage at the beginning", function() {
        var actual = progressBarPercentage(moment("2016-07-27T12:00:00.000Z"), moment("2016-08-10T12:00:00.000Z"), moment("2016-08-10T11:30:59.000Z"));
        Assert.assertEquals("99.85", actual);
    });


    testSuiteTimeLeft.run();
});
</script>
</body>
</html>

