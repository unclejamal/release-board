<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="Release dashboard">
<meta name="author" content="Pawel Duda">

<title>Release dashboad</title>

<!-- Bootstrap core CSS -->
<link href="./css/bootstrap.min.css" rel="stylesheet">

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<link href="./css/ie10-viewport-bug-workaround.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="./css/cover.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
<script src="./js/ie-emulation-modes-warning.js"></script>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<div class="site-wrapper">

  <div class="site-wrapper-inner">

    <div class="cover-container">

      <div class="inner cover">
        <h1 class="release cover-heading">Release 45</h1>
        <h2 class="release-period cover-heading">10/10/2016 - 24/10/2016</h2>
        <div class="release-bar progress">
          <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
            <span class="progress-bar-text-inside">1 day left</span>
          </div>
        </div>
      </div>

    </div>

  </div>

</div>

<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="./js/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="./js/jquery.min.js"><\/script>')</script>
<script src="./js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="./js/ie10-viewport-bug-workaround.js"></script>
<script src="./js/moment.js"></script>
<script>

$(document).ready(function() {
    function $_GET(param) {
    var vars = {};
    window.location.href.replace( location.hash, '' ).replace( 
      /[?&]+([^=&]+)=?([^&]*)?/gi,
      function( m, key, value ) {
      vars[key] = value !== undefined ? value : '';
      }
      );

    if ( param ) {
    return vars[param] ? vars[param] : null;
    }
    return vars;
    }

    function howMuchTimeLeft(startDate, endDate, nowDate) {
       if (nowDate.isSame(endDate, 'day')) {
         return "the cut is today";
       } else {
         return "the cut is tomorrow";
       }
    };



    var refStartDate = moment($_GET("refStartDate"));
    var refEndDate = moment($_GET("refEndDate"));
    var nowDate = moment();
    var dateTimeFormat = "dddd, MMMM Do YYYY, h:mm:ss a";
    $(".progress-bar-text-inside").text(howMuchTimeLeft(refStartDate, refEndDate, nowDate));
    $(".release-period").text(refStartDate.format(dateTimeFormat) + " - " + refEndDate.format(dateTimeFormat));

    var release = $_GET("releaseWord") + " " + $_GET("refName");
    $(".release").text(release);


    // TEST FRAMEWORK
    function Assert() {
    };
    Assert.assertEquals = function(expected, actual) {
      if (expected != actual) { throw "Expected [" + expected + "] but was [" + actual + "]" };
    };

    function TestSuiteResults() {
      this.failures = {};

      this.addFailure= function(testName, errorMessage) {
        this.failures[testName] = errorMessage;
      };

      this.present = function() {
        if (Object.keys(this.failures).length != 0) {
          $(".site-wrapper").css("background-color", "#880e0e");
          $(".site-wrapper").empty();

          var that = this;
          Object.keys(this.failures).forEach(function(testName) {
            var failure = "[FAILURE] " + testName + " : " + that.failures[testName];
            $(".site-wrapper").append("<h2>" + failure + "</h2>");
          });
        }
      };
    };

    function TestSuite() {
      this.tests = {};

      this.addTest = function(testTitle, testFunction) {
        this.tests[testTitle] = testFunction;
      };

      this.run = function() {
        var that = this;
        var testSuiteResults = new TestSuiteResults();
        Object.keys(this.tests).forEach(function(testName) {
            try {
              that.tests[testName](testSuiteResults);
            } catch (errorMessage) {
              testSuiteResults.addFailure(testName, errorMessage);
            };
        });

        testSuiteResults.present();
      }
    };


    // TEST SUITE
    var testSuiteTimeLeft = new TestSuite();
    testSuiteTimeLeft.addTest("on the day of the cut", function() {
        var actual = howMuchTimeLeft("2016-07-27T12:00:00.000Z", "2016-08-10T12:00:00.000Z", moment("2016-08-10T10:00:00.000Z"));
        Assert.assertEquals("the cut is today", actual);
    });
    testSuiteTimeLeft.addTest("cut", function() {
        var actual = howMuchTimeLeft("2016-07-27T12:00:00.000Z", "2016-08-10T12:00:00.000Z", moment("2016-08-10T10:00:00.000Z"));
        Assert.assertEquals("the cut is today", actual);
    });

    testSuiteTimeLeft.run();
});
</script>
</body>
</html>

